<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.8.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.8.0" type="image/png" sizes="32x32"><meta name="description" content="指数型dfs(选或不选)        参数 ： 前u个数 选 or 不选 的 需要保存第x位置的状态的时候就需要用st数组来存状态 int st[] 0：没有遇见 1 选 2不选  代码模板 12345678910111213141516171819202122232425262728293031#include &lt;iostream&gt;#incl">
<meta property="og:type" content="article">
<meta property="og:title" content="bfs与dfs实战">
<meta property="og:url" content="https://1artemise.github.io/2025/11/21/bfs&&dfs/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="指数型dfs(选或不选)        参数 ： 前u个数 选 or 不选 的 需要保存第x位置的状态的时候就需要用st数组来存状态 int st[] 0：没有遇见 1 选 2不选  代码模板 12345678910111213141516171819202122232425262728293031#include &lt;iostream&gt;#incl">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://1artemise.github.io/images/image-20251121171812054.png">
<meta property="og:image" content="https://1artemise.github.io/images/image-20251121171925635.png">
<meta property="og:image" content="https://1artemise.github.io/images/image-20251121171952903.png">
<meta property="article:published_time" content="2025-11-20T16:00:00.000Z">
<meta property="article:modified_time" content="2025-11-24T14:10:38.334Z">
<meta property="article:author" content="artemis">
<meta property="article:tag" content="算法">
<meta property="article:tag" content="acm">
<meta property="article:tag" content="数据结构">
<meta property="article:tag" content="dfs">
<meta property="article:tag" content="bfs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://1artemise.github.io/images/image-20251121171812054.png"><title>bfs与dfs实战 | Hexo</title><link ref="canonical" href="https://1artemise.github.io/2025/11/21/bfs&amp;&amp;dfs/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.8.0"><link rel="stylesheet" href="css/custom.css"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: undefined,
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: {"colWidth":"220px","gapX":"10px"},
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-book-open"></i></span><span class="header-nav-menu-item__text">文章</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/friends/"><span class="header-nav-menu-item__icon"><i class="fas fa-handshake"></i></span><span class="header-nav-menu-item__text">友链</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/gallery/"><span class="header-nav-menu-item__icon"><i class="fas fa-camera"></i></span><span class="header-nav-menu-item__text">相册</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">关于我</span></a></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">欢迎来到我的世界</div><div class="header-banner-info__subtitle">也许我们未曾相逢，也不会见面，但陌生人，愿你平和而勇敢；
也许我们相识已久，也常常遇见，我的朋友，愿我们总如初见</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-header-title">bfs与dfs实战</h1><div class="post-header-meta"><span class="post-header-meta__item"><span class="post-header-meta__icon"><i class="fas fa-calendar-alt"></i></span><time class="post-header-meta__text" datetime="2025-11-20T16:00:00.000Z">2025-11-21</time></span><span class="post-header-meta__item"><span class="post-header-meta__icon"><i class="fas fa-folder"></i></span><a class="post-header-meta__text" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></span></div></header><div class="post-body">
        <h1 id="指数型dfs-选或不选"   >
          <a href="#指数型dfs-选或不选" class="heading-link"><i class="fas fa-link"></i></a><a href="#指数型dfs-选或不选" class="headerlink" title="指数型dfs(选或不选)"></a>指数型dfs(选或不选)</h1>
      <ul>
<li>参数 ： 前u个数 选 or 不选 的</li>
<li><strong>需要保存第x位置的状态的时候就需要用st数组来存状态</strong></li>
<li>int st[] 0：没有遇见 1 选 2不选</li>
</ul>
<p>代码模板</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">16</span>;</span><br><span class="line"><span class="type">int</span> st[N]; </span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> u)</span> </span>&#123;<span class="comment">//u ：层数</span></span><br><span class="line">  <span class="keyword">if</span> (u &gt; n) &#123;<span class="comment">//叶子结点</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;=n; i ++ )&#123;</span><br><span class="line">      <span class="keyword">if</span> (st[i] == <span class="number">1</span>) &#123;<span class="comment">//如果选了 就输出 1选 2不选</span></span><br><span class="line">        cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  st [u] = <span class="number">1</span>;<span class="comment">//选</span></span><br><span class="line">  <span class="built_in">dfs</span> (u + <span class="number">1</span>);<span class="comment">//递归下一层</span></span><br><span class="line">  st[u] = <span class="number">0</span>;<span class="comment">//回溯</span></span><br><span class="line">  </span><br><span class="line">   st[u] = <span class="number">2</span>;<span class="comment">//不选</span></span><br><span class="line">  <span class="built_in">dfs</span> (u<span class="number">+1</span>);<span class="comment">//递归下一层</span></span><br><span class="line">  st[u] = <span class="number">0</span>;<span class="comment">//回溯 【恢复现场】 </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  cin &gt;&gt; n;</span><br><span class="line">  <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="烤鸡"   >
          <a href="#烤鸡" class="heading-link"><i class="fas fa-link"></i></a><a href="#烤鸡" class="headerlink" title="烤鸡"></a>烤鸡</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2089" >P2089 烤鸡 - 洛谷</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="题意"   >
          <a href="#题意" class="heading-link"><i class="fas fa-link"></i></a><a href="#题意" class="headerlink" title="题意"></a>题意</h3>
      <p>10 种配料，每种可以放 <strong>1~3 克</strong>，总美味程度 &#x3D; 所有配料质量之和 &#x3D; n，输出所有可能的配方数和配方（按字典序）没有方案则输出 0</p>

        <h3 id="思路"   >
          <a href="#思路" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路" class="headerlink" title="思路"></a>思路</h3>
      <figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[<span class="number">11</span>];  <span class="comment">// a[1]~a[10] 存储配料</span></span><br><span class="line"><span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> m[<span class="number">60000</span>][<span class="number">11</span>];  <span class="comment">// 第二维只需要11</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> sum)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sum &gt; n) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">10</span>) &#123;  <span class="comment">// 处理完10种配料</span></span><br><span class="line">        <span class="keyword">if</span> (sum == n) &#123;</span><br><span class="line">            cnt++;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                m[cnt][i] = a[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++) &#123;</span><br><span class="line">        a[x] = i;</span><br><span class="line">        <span class="built_in">dfs</span>(x + <span class="number">1</span>, sum + i);</span><br><span class="line">        a[x] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>, <span class="number">0</span>);  <span class="comment">// 从第1种配料开始</span></span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; cnt &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= cnt; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">10</span>; j++) &#123;</span><br><span class="line">            cout &lt;&lt; m[i][j] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="PERKET"   >
          <a href="#PERKET" class="heading-link"><i class="fas fa-link"></i></a><a href="#PERKET" class="headerlink" title="PERKET"></a>PERKET</h2>
      <p>[P2036 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2036" >COCI 2008&#x2F;2009 #2] PERKET - 洛谷</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="题意-1"   >
          <a href="#题意-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#题意-1" class="headerlink" title="题意"></a>题意</h3>
      <p>你有 <code>n</code> 种配料，每种可以<strong>选</strong>或<strong>不选</strong>，但不能全不选。<br>对于选中的配料：</p>
<ul>
<li>总酸度 &#x3D; 选中配料的酸度的<strong>乘积</strong></li>
<li>总苦度 &#x3D; 选中配料的苦度的<strong>总和</strong></li>
<li>目标是 <code>min(|酸度 - 苦度|)</code></li>
</ul>

        <h3 id="思路-1"   >
          <a href="#思路-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3>
      <p>由于每个调料可选可不选，我们可以用一个st数组判断状态，1表示选，2表示不选。最后计算的时候遍历数组，只有st[i]&#x3D;&#x3D;1时才计算s,b。</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> s, b;</span><br><span class="line"><span class="type">int</span> st[<span class="number">200</span>];</span><br><span class="line"><span class="type">int</span> res = <span class="number">1e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>&#123;</span><br><span class="line">    <span class="type">int</span> s, b;</span><br><span class="line">&#125; a[<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">bool</span> has= <span class="literal">false</span>;  <span class="comment">// 标记是否存在至少一个被选中的元素</span></span><br><span class="line">    <span class="keyword">if</span> (x &gt; n) &#123;</span><br><span class="line">        <span class="type">int</span> sum1 = <span class="number">1</span>;  <span class="comment">// 计算选中元素的s属性乘积</span></span><br><span class="line">        <span class="type">int</span> sum2 = <span class="number">0</span>;  <span class="comment">// 计算选中元素的b属性和</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (st[i] == <span class="number">1</span>) &#123;  <span class="comment">// 如果元素被选中</span></span><br><span class="line">                has = <span class="literal">true</span>;     <span class="comment">// 标记存在选中元素</span></span><br><span class="line">                sum1 *= a[i].s; <span class="comment">// 累乘s属性</span></span><br><span class="line">                sum2 += a[i].b; <span class="comment">// 累加b属性</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果存在至少一个选中的元素，更新结果</span></span><br><span class="line">        <span class="keyword">if</span> (has) &#123;</span><br><span class="line">            res = <span class="built_in">min</span>(res, <span class="built_in">abs</span>(sum1 - sum2));  <span class="comment">// 更新最小差值</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">// 递归处理：选择当前元素</span></span><br><span class="line">  st[x] = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">dfs</span>(x + <span class="number">1</span>);</span><br><span class="line">  st[x] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 递归处理：不选择当前元素</span></span><br><span class="line">  st[x] = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">dfs</span>(x + <span class="number">1</span>);</span><br><span class="line">  st[x] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n;i++)&#123;</span><br><span class="line">      cin &gt;&gt;a[i].s &gt;&gt; a[i].b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>当然还有一种写法。直接多往dfs里面传参</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> s[<span class="number">15</span>], b[<span class="number">15</span>];</span><br><span class="line"><span class="type">int</span> ans = <span class="number">1e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> total_s, <span class="type">int</span> total_b, <span class="type">bool</span> chosen)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index == n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (chosen) &#123;</span><br><span class="line">            ans = <span class="built_in">min</span>(ans, <span class="built_in">abs</span>(total_s - total_b));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 不选当前配料</span></span><br><span class="line">    <span class="built_in">dfs</span>(index + <span class="number">1</span>, total_s, total_b, chosen);</span><br><span class="line">    <span class="comment">// 选当前配料</span></span><br><span class="line">    <span class="built_in">dfs</span>(index + <span class="number">1</span>, total_s * s[index], total_b + b[index], <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; s[i] &gt;&gt; b[i];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="全排列型dfs"   >
          <a href="#全排列型dfs" class="heading-link"><i class="fas fa-link"></i></a><a href="#全排列型dfs" class="headerlink" title="全排列型dfs"></a>全排列型dfs</h1>
      <p>大概是每个位置要选什么数字，模板如下</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> path[N];<span class="comment">//保存序列</span></span><br><span class="line"><span class="type">int</span> state[N];<span class="comment">//数字是否被用过</span></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(u &gt; n)<span class="comment">//数字填完了，输出</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)<span class="comment">//输出方案</span></span><br><span class="line">            cout &lt;&lt; path[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)<span class="comment">//空位上可以选择的数字为:1 ~ n</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!state[i])<span class="comment">//如果数字 i 没有被用过</span></span><br><span class="line">        &#123;</span><br><span class="line">            path[u] = i;<span class="comment">// 放入空位</span></span><br><span class="line">            state[i] = <span class="number">1</span>;<span class="comment">//数字被用，修改状态</span></span><br><span class="line">            <span class="built_in">dfs</span>(u + <span class="number">1</span>);<span class="comment">//填下一个位</span></span><br><span class="line">            state[i] = <span class="number">0</span>;<span class="comment">//回溯，取出 i</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>先来一道模板题</p>

        <h2 id="全排列问题"   >
          <a href="#全排列问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#全排列问题" class="headerlink" title="全排列问题"></a>全排列问题</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1706" >P1706 全排列问题 - 洛谷</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="题意-2"   >
          <a href="#题意-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#题意-2" class="headerlink" title="题意"></a>题意</h3>
      <p>按照字典序输出自然数 1 到 <em>n</em> 所有不重复的排列，即 <em>n</em> 的全排列，要求所产生的任一数字序列中不允许出现重复的数字。</p>

        <h3 id="思路-2"   >
          <a href="#思路-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路-2" class="headerlink" title="思路"></a>思路</h3>
      <p>好像没什么好说的，太模板了</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[<span class="number">100</span>];</span><br><span class="line"><span class="type">bool</span> vis[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; n) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%5d&quot;</span>, a[i]); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i]) &#123;</span><br><span class="line">            a[x] = i;</span><br><span class="line">            vis[i] = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">dfs</span>(x + <span class="number">1</span>);</span><br><span class="line">            vis[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="火星人"   >
          <a href="#火星人" class="heading-link"><i class="fas fa-link"></i></a><a href="#火星人" class="headerlink" title="火星人"></a>火星人</h2>
      <p>[P1088 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1088" >NOIP 2004 普及组] 火星人 - 洛谷</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="题意-3"   >
          <a href="#题意-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#题意-3" class="headerlink" title="题意"></a>题意</h3>
      <p>由1-n（不重复）组成的全排列数里，有a,b，假设全排列数列已经sort好，你要找到中找到a后面的第b个数。</p>

        <h3 id="思路-3"   >
          <a href="#思路-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路-3" class="headerlink" title="思路"></a>思路</h3>
      <p>这道题的本质就是全排列，如果不考虑数据范围的话，直接这么写</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; all;  <span class="comment">// 存储所有排列</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; cur;  <span class="comment">// 当前排列</span></span><br><span class="line"><span class="type">bool</span> vis[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, vector&lt;<span class="type">int</span>&gt;&amp; temp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; n) &#123;</span><br><span class="line">        all.<span class="built_in">push_back</span>(temp);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i]) &#123;</span><br><span class="line">            vis[i] = <span class="literal">true</span>;</span><br><span class="line">            temp[x<span class="number">-1</span>] = i;  <span class="comment">// 索引从0开始</span></span><br><span class="line">            <span class="built_in">dfs</span>(x + <span class="number">1</span>, temp);</span><br><span class="line">            vis[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    cur.<span class="built_in">resize</span>(n);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读入当前排列</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; cur[i];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成全排列</span></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">temp</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>, temp);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 排序（vector默认按字典序比较）</span></span><br><span class="line">    <span class="built_in">sort</span>(all.<span class="built_in">begin</span>(), all.<span class="built_in">end</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 找到当前位置</span></span><br><span class="line">    <span class="type">int</span> pos = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; all.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (all[i] == cur) &#123;</span><br><span class="line">            pos = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 输出新排列</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; result = all[pos + m];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cout &lt;&lt; result[i];</span><br><span class="line">        <span class="keyword">if</span> (i &lt; n - <span class="number">1</span>) cout &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>注意到题目N&lt;10000，那枚举会达到恐怖的10000!。所以这段代码你交上去只能得20分。其他的MLE了。</p>
<p>剪枝好像也没有什么操作空间。</p>
<p>这时候不得不提到STL的喵喵小工具。</p>
<p><strong>我们可以利用 C++ STL 的 <code>next_permutation</code> 函数来高效解决。</strong></p>

        <h4 id="next-permutation-工作原理"   >
          <a href="#next-permutation-工作原理" class="heading-link"><i class="fas fa-link"></i></a><a href="#next-permutation-工作原理" class="headerlink" title="next_permutation 工作原理"></a><code>next_permutation</code> 工作原理</h4>
      <ol>
<li>从右向左找到第一个升序对 <code>(i, i+1)</code>，满足 <code>a[i] &lt; a[i+1]</code></li>
<li>从右向左找到第一个大于 <code>a[i]</code> 的元素 <code>a[j]</code></li>
<li>交换 <code>a[i]</code> 和 <code>a[j]</code></li>
<li>将 <code>a[i+1]</code> 到末尾的元素反转</li>
</ol>

        <h4 id="时间复杂度"   >
          <a href="#时间复杂度" class="heading-link"><i class="fas fa-link"></i></a><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h4>
      <ul>
<li>每次 <code>next_permutation</code> 操作：O(N)</li>
<li>总共 M 次操作：O(N × M)</li>
<li>在 N≤10000, M≤100 时完全可行</li>
</ul>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读入当前排列</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">fingers</span><span class="params">(n)</span></span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    cin &gt;&gt; fingers[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 next_permutation 找第 m 个后续排列</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">    <span class="built_in">next_permutation</span>(fingers.<span class="built_in">begin</span>(), fingers.<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>就是如此简单，附上AC代码</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    </span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">fingers</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; fingers[i];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用 next_permutation 找第 m 个后续排列</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="built_in">next_permutation</span>(fingers.<span class="built_in">begin</span>(), fingers.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 输出结果</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cout &lt;&lt; fingers[i];</span><br><span class="line">        <span class="keyword">if</span> (i &lt; n - <span class="number">1</span>) cout &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="组合型dfs"   >
          <a href="#组合型dfs" class="heading-link"><i class="fas fa-link"></i></a><a href="#组合型dfs" class="headerlink" title="组合型dfs"></a>组合型dfs</h1>
      <ul>
<li><strong>与全排列的差别就是第二个for循环开始的位置，换句话说就是每个数该放什么位置。</strong></li>
</ul>
<p>模板如下</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">30</span>;</span><br><span class="line"><span class="type">int</span> path[N];</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span> <span class="params">(<span class="type">int</span> u, <span class="type">int</span> start )</span> </span>&#123;<span class="comment">//u:层数  start：起始的数值</span></span><br><span class="line">    <span class="keyword">if</span> (u &gt; m) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i ++ ) &#123;</span><br><span class="line">            cout &lt;&lt; path[i] &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = start; i &lt;= n; i ++) &#123;<span class="comment">//</span></span><br><span class="line">            path[u] = i;<span class="comment">//表示已经填了</span></span><br><span class="line">            <span class="built_in">dfs</span>(u + <span class="number">1</span>, i + <span class="number">1</span>);<span class="comment">//递归下一层</span></span><br><span class="line">            path[u] = <span class="number">0</span>;<span class="comment">//恢复现场</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">1</span>); <span class="comment">//第一层开始  且从1开始枚举</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h2 id="选数"   >
          <a href="#选数" class="heading-link"><i class="fas fa-link"></i></a><a href="#选数" class="headerlink" title="选数"></a>选数</h2>
      <p>[P1036 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1036#submit" >NOIP 2002 普及组] 选数 - 洛谷</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="题意-4"   >
          <a href="#题意-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#题意-4" class="headerlink" title="题意"></a>题意</h3>
      <p>已知 <em>n</em> 个整数 <em>x</em>1,<em>x</em>2,⋯,<em>x**n</em>，以及 1 个整数 <em>k</em>（<em>k</em>&lt;<em>n</em>）。从 <em>n</em> 个整数中任选 <em>k</em> 个整数相加，可分别得到一系列的和。求和为素数的有多少种</p>

        <h3 id="思路-4"   >
          <a href="#思路-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路-4" class="headerlink" title="思路"></a>思路</h3>
      <p>对于这个dfs的状态，三点就可以描述</p>
<ul>
<li><code>idx</code>：知道处理到哪了</li>
<li><code>cnt</code>：知道选了几个</li>
<li><code>sum</code>：知道当前和是多少</li>
</ul>
<p>对于每个位置idx，有选和不选两种选择，如果选择</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dfs</span>(idx + <span class="number">1</span>, cnt + <span class="number">1</span>, sum + a[idx]);<span class="comment">//移到下一个数，选择数量加一，和增加</span></span><br></pre></td></tr></table></div></figure>

<p>如果不选</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dfs</span>(idx + <span class="number">1</span>, cnt, sum);</span><br></pre></td></tr></table></div></figure>

<p>写dfs除了状态参数，第一个写的就是终止状态，什么时候终止呢，idx&gt;n时说明已经考虑完所有数字了。但是此时还必须刚好选择k个元素，然后还要检查和是否为素数</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (idx &gt; n) &#123;</span><br><span class="line">    <span class="keyword">if</span> (cnt == k &amp;&amp; <span class="built_in">is_prime</span>(sum)) &#123;</span><br><span class="line">        ans++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>附上ac代码</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, k;</span><br><span class="line"><span class="type">int</span> a[<span class="number">25</span>];</span><br><span class="line"><span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_prime</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= x; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x % i == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> idx, <span class="type">int</span> cnt, <span class="type">int</span> sum)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 已经考虑完所有元素</span></span><br><span class="line">    <span class="keyword">if</span> (idx &gt; n) &#123;</span><br><span class="line">        <span class="comment">// 必须正好选择k个元素且和为素数</span></span><br><span class="line">        <span class="keyword">if</span> (cnt == k &amp;&amp; <span class="built_in">is_prime</span>(sum)) &#123;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择1：选取当前元素（前提是还没选够k个）</span></span><br><span class="line">    <span class="keyword">if</span> (cnt &lt; k) &#123;</span><br><span class="line">        <span class="built_in">dfs</span>(idx + <span class="number">1</span>, cnt + <span class="number">1</span>, sum + a[idx]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择2：不选取当前元素</span></span><br><span class="line">    <span class="built_in">dfs</span>(idx + <span class="number">1</span>, cnt, sum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; k;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="八皇后问题"   >
          <a href="#八皇后问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#八皇后问题" class="headerlink" title="八皇后问题"></a>八皇后问题</h1>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1219" >洛谷USACO1.5八皇后</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="题意-5"   >
          <a href="#题意-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#题意-5" class="headerlink" title="题意"></a>题意</h2>
      <p>nxn的棋盘，同一行和同一列不可以有两个棋子，且每条对角线都至多有一个棋子。让你给出三种解法里面的列标，以及最后的解法数。</p>

        <h2 id="思路-5"   >
          <a href="#思路-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路-5" class="headerlink" title="思路"></a>思路</h2>
      <p>非常典型的dfs回溯问题。唯一需要思考的，是我该怎么回溯。怎么来构建这个dfs图。</p>
<p>很朴素经典的dfs思想是，从第一行开始放棋，对于每一行，尝试完所有的位置，尝试完后到下一行。检查每个位置是否满足条件，满足就标记且占用，而且递归处理下一行。（记得要回溯尝试其他可能，要取消标记和占用）那么行数其实就是这个dfs树的深度（dep）了。你的脑子里应该马上有这一段。</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> dep)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep==n<span class="number">+1</span>)&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="comment">//列的遍历</span></span><br><span class="line">        <span class="keyword">if</span>(check)&#123;</span><br><span class="line">            <span class="comment">//标记并记录</span></span><br><span class="line">            <span class="built_in">dfs</span>(dep<span class="number">+1</span>)<span class="comment">//递归</span></span><br><span class="line">     		  <span class="comment">// 回溯                  </span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>接下来就是完善细节。由于我们是一行一行遍历，找到符合条件的进入下一行**，所以完全不用担心一行会出现两**个棋子。所以我们需要考虑的只有对角线和每一列。注意我们还要标记每行里面放皇后的列号。因此我们需要两个数组来存储。<strong>vis数组看每列是否有访问，col数组存储每行放置棋子的列号。</strong></p>
<p>对于对角线，如果你第一次接触这个问题可能会想到用循环解决，事实上有着更简单的检查方法。</p>
<p><img src="/../images/image-20251121171812054.png" alt="image-20251121171812054"></p>
<p><strong>对于主对角线</strong>，我们不难发现，<strong>行-列一定是一个同样的数字。</strong></p>
<p><strong>对于副对角线</strong>，我们也可以发现，列＋行也是一个同样的数字</p>
<p><img src="/../images/image-20251121171925635.png" alt="image-20251121171925635"></p>
<p>举个例子，如果我在（2，4）放了棋子</p>
<p><img src="/../images/image-20251121171952903.png" alt="image-20251121171952903"></p>
<p><strong>但是涉及到减号我们就要格外注意数组越界</strong>，因为行-列并不总是正数。</p>
<p>这里我们不需要边界检查，只需要用到一个常用的偏移技巧就好。都加上n。（不细说了自行脑补）</p>
<p>附上AC代码</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">20</span>;</span><br><span class="line"><span class="type">int</span> n, total = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> col[N];          <span class="comment">// 存储每一行皇后所在的列号</span></span><br><span class="line"><span class="type">bool</span> vis[N];        <span class="comment">// 标记列是否被占用</span></span><br><span class="line"><span class="type">bool</span> diag1[<span class="number">2</span>*N];     <span class="comment">// 主对角线 (r - c + n)</span></span><br><span class="line"><span class="type">bool</span> diag2[<span class="number">2</span>*N];     <span class="comment">// 副对角线 (r + c)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cout &lt;&lt; col[i];</span><br><span class="line">        <span class="keyword">if</span> (i &lt; n) cout &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> dep)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep == n + <span class="number">1</span>) &#123;</span><br><span class="line">        total++;</span><br><span class="line">        <span class="keyword">if</span> (total &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="built_in">print</span>();<span class="comment">//只打印前三个解</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="comment">// 检查列和对角线是否被占用</span></span><br><span class="line">        <span class="keyword">if</span> (!vis[i] &amp;&amp; !diag1[dep - i + n] &amp;&amp; !diag2[dep + i]) &#123;</span><br><span class="line">            <span class="comment">// 放置皇后</span></span><br><span class="line">            <span class="comment">//标记主对角线是否被占用（r-i 可能为负数，所以 +n 偏移）</span></span><br><span class="line">            col[dep] = i;</span><br><span class="line">            vis[i] = <span class="literal">true</span>;</span><br><span class="line">            diag1[dep - i + n] = <span class="literal">true</span>;</span><br><span class="line">            diag2[dep + i] = <span class="literal">true</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 递归下一行</span></span><br><span class="line">            <span class="built_in">dfs</span>(dep + <span class="number">1</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 回溯</span></span><br><span class="line">            vis[i] = <span class="literal">false</span>;</span><br><span class="line">            diag1[dep - i + n] = <span class="literal">false</span>;</span><br><span class="line">            diag2[dep + i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">    cout &lt;&lt; total &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>), cin.<span class="built_in">tie</span>(<span class="number">0</span>), cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="单词接龙"   >
          <a href="#单词接龙" class="heading-link"><i class="fas fa-link"></i></a><a href="#单词接龙" class="headerlink" title="单词接龙"></a>单词接龙</h1>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1019" >洛谷P1019 [NOIP 2000 提高组] 单词接龙（疑似错题）</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="题意-6"   >
          <a href="#题意-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#题意-6" class="headerlink" title="题意"></a>题意</h2>
      <p>你有 n 个单词，每个单词最多用两次。给定一个起始字母，要找出最长的“龙”。接龙规则是相邻单词必须有重合部分，但不能是包含关系。</p>
<p>比如 <code>beast</code> 接 <code>astonish</code>，重合 <code>&quot;ast&quot;</code>，变成 <code>beastonish</code>。</p>

        <h2 id="思路-6"   >
          <a href="#思路-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路-6" class="headerlink" title="思路"></a>思路</h2>
      <p>依旧典型的 DFS 回溯问题</p>
<p>依旧很朴素经典的 DFS 思想是：从起始字母的单词开始，对于当前龙字符串，尝试所有能接上的单词，接上后递归处理更长的龙，然后回溯尝试其他可能。</p>
<p>那么<strong>当前龙的长度</strong>其实就是这个 DFS 树的深度。理清楚下dfs的要点</p>
<ul>
<li><strong>状态</strong>：当前拼接的龙字符串 <code>tmp</code></li>
<li><strong>选择</strong>：所有使用次数 <code>&lt; 2</code> 且能与当前龙末尾重合的单词</li>
<li><strong>递归深度</strong>：龙的长度</li>
<li><strong>回溯</strong>：恢复单词使用次数</li>
</ul>
<p>这就是大概框架，接下来理一下细节</p>

        <h3 id="有重合不可以包含"   >
          <a href="#有重合不可以包含" class="heading-link"><i class="fas fa-link"></i></a><a href="#有重合不可以包含" class="headerlink" title="有重合不可以包含"></a>有重合不可以包含</h3>
      <p>我们枚举重合长度。如果包含的话，会遍历到待接龙字符串的最后一位，所以我们不能取等。</p>
<ul>
<li><code>j</code> 从 1 开始：至少重合1个字符</li>
<li>不取等</li>
</ul>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; <span class="built_in">min</span>(tmp.<span class="built_in">size</span>(), s[i].<span class="built_in">size</span>()); ++j)</span><br></pre></td></tr></table></div></figure>


        <h3 id="字符串是否匹配（可以重合）"   >
          <a href="#字符串是否匹配（可以重合）" class="heading-link"><i class="fas fa-link"></i></a><a href="#字符串是否匹配（可以重合）" class="headerlink" title="字符串是否匹配（可以重合）"></a>字符串是否匹配（可以重合）</h3>
      <p>匹配就是看当前字符的后面和待匹配字符的前面，用.substr()</p>
<ul>
<li><code>tmp.substr(tmp.size() - j)</code>：取当前龙末尾 j 个字符</li>
<li><code>s[i].substr(0, j)</code>：取候选单词开头 j 个字符</li>
<li>两者相等说明可以接龙</li>
</ul>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp.<span class="built_in">substr</span>(tmp.<span class="built_in">size</span>() - j) == s[i].<span class="built_in">substr</span>(<span class="number">0</span>, j)</span><br></pre></td></tr></table></div></figure>


        <h3 id="拼接方式"   >
          <a href="#拼接方式" class="heading-link"><i class="fas fa-link"></i></a><a href="#拼接方式" class="headerlink" title="拼接方式"></a>拼接方式</h3>
      <ul>
<li>去掉重合部分：当前龙 + 单词i去掉前j个字符</li>
<li>比如 <code>&quot;beast&quot;</code> 接 <code>&quot;astonish&quot;</code>，重合 <code>&quot;ast&quot;</code>：<ul>
<li><code>&quot;beast&quot; + &quot;astonish&quot;.substr(3) = &quot;beast&quot; + &quot;onish&quot; = &quot;beastonish&quot;</code></li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp + s[i].<span class="built_in">substr</span>(j)</span><br></pre></td></tr></table></div></figure>


        <h3 id="次数控制"   >
          <a href="#次数控制" class="heading-link"><i class="fas fa-link"></i></a><a href="#次数控制" class="headerlink" title="次数控制"></a>次数控制</h3>
      <p>其实就是vis++，和一般的访问数组一样</p>

        <h3 id="附上AC代码"   >
          <a href="#附上AC代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#附上AC代码" class="headerlink" title="附上AC代码"></a>附上AC代码</h3>
      <figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">string a[<span class="number">1000</span>];  <span class="comment">// 存储所有单词的数组</span></span><br><span class="line"><span class="type">int</span> n, ans;      <span class="comment">// n: 单词数量, ans: 记录最长龙的长度</span></span><br><span class="line"><span class="type">int</span> vis[<span class="number">1000</span>] = &#123;<span class="number">0</span>&#125;;  <span class="comment">// 记录每个单词的使用次数，初始化为0</span></span><br><span class="line">string s;        <span class="comment">// 这个变量定义后未使用，可以删除</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// DFS深度优先搜索函数</span></span><br><span class="line"><span class="comment">// tmp: 当前已经拼接形成的龙字符串</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">const</span> string&amp; tmp)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 更新最大长度：比较当前龙的长度与历史最大值</span></span><br><span class="line">    ans = <span class="built_in">max</span>(ans, <span class="built_in">int</span>(tmp.<span class="built_in">size</span>()));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历所有单词，寻找可以接龙的单词</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="comment">// 如果当前单词已经使用过2次，跳过</span></span><br><span class="line">        <span class="keyword">if</span> (vis[i] &gt;= <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 枚举所有可能的重合长度j</span></span><br><span class="line">        <span class="comment">// j的范围：1 到 min(当前龙长度, 候选单词长度)-1</span></span><br><span class="line">        <span class="comment">// 注意：j不能等于最小值，否则会出现包含关系</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; <span class="built_in">min</span>(tmp.<span class="built_in">size</span>(), a[i].<span class="built_in">size</span>()); j++) &#123;</span><br><span class="line">            <span class="comment">// 检查当前龙末尾的j个字符是否等于候选单词开头的j个字符</span></span><br><span class="line">            <span class="keyword">if</span> (tmp.<span class="built_in">substr</span>(tmp.<span class="built_in">size</span>() - j) == a[i].<span class="built_in">substr</span>(<span class="number">0</span>, j)) &#123;</span><br><span class="line">                <span class="comment">// 找到可以接龙的单词，标记为已使用</span></span><br><span class="line">                vis[i]++;</span><br><span class="line">                <span class="comment">// 递归搜索：当前龙 + 候选单词去掉前j个字符（去掉重合部分）</span></span><br><span class="line">                <span class="comment">// 例如：&quot;beast&quot; + &quot;astonish&quot;.substr(3) = &quot;beast&quot; + &quot;onish&quot; = &quot;beastonish&quot;</span></span><br><span class="line">                <span class="built_in">dfs</span>(tmp + a[i].<span class="built_in">substr</span>(j));</span><br><span class="line">                <span class="comment">// 回溯：恢复该单词的使用次数，尝试其他可能性</span></span><br><span class="line">                vis[i]--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 读入单词数量</span></span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="comment">// 读入所有单词，从下标1开始存储</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读入起始字母</span></span><br><span class="line">    <span class="type">char</span> c;</span><br><span class="line">    cin &gt;&gt; c;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 从所有以起始字母c开头的单词开始DFS搜索</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i][<span class="number">0</span>] == c) &#123;</span><br><span class="line">            vis[i]++;      <span class="comment">// 标记该起始单词使用1次</span></span><br><span class="line">            <span class="built_in">dfs</span>(a[i]);     <span class="comment">// 从该单词开始DFS搜索</span></span><br><span class="line">            vis[i]--;      <span class="comment">// 回溯：恢复使用次数</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 输出最长龙的长度</span></span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 加速输入输出</span></span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>), cin.<span class="built_in">tie</span>(<span class="number">0</span>), cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="补充"   >
          <a href="#补充" class="heading-link"><i class="fas fa-link"></i></a><a href="#补充" class="headerlink" title="补充"></a>补充</h3>
      <p>这一版本的代码非常简单直观，但是也有它的问题</p>
<ul>
<li><strong>重复计算</strong>：相同的单词对会在不同DFS路径中反复检查重合</li>
<li><strong>无效尝试</strong>：有些单词根本不可能接上，但每次都要枚举</li>
</ul>

        <h4 id="预处理重合"   >
          <a href="#预处理重合" class="heading-link"><i class="fas fa-link"></i></a><a href="#预处理重合" class="headerlink" title="预处理重合"></a>预处理重合</h4>
      <p>由于要长度最长，所以只需找到最小重合，重合越少最后越长。</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> overlap[N][N];  <span class="comment">// overlap[i][j]表示单词i接单词j的最小重合长度，0表示不能接</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 预处理函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">preprocess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            overlap[i][j] = <span class="number">0</span>;  <span class="comment">// 初始化为不能接</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt; <span class="built_in">min</span>(s[i].<span class="built_in">size</span>(), s[j].<span class="built_in">size</span>()); k++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s[i].<span class="built_in">substr</span>(s[i].<span class="built_in">size</span>() - k) == s[j].<span class="built_in">substr</span>(<span class="number">0</span>, k)) &#123;</span><br><span class="line">                    overlap[i][j] = k;</span><br><span class="line">                    <span class="keyword">break</span>;  <span class="comment">// 找到最小重合就退出</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="预处理之后重新查表"   >
          <a href="#预处理之后重新查表" class="heading-link"><i class="fas fa-link"></i></a><a href="#预处理之后重新查表" class="headerlink" title="预处理之后重新查表"></a>预处理之后重新查表</h4>
      <figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">const</span> string &amp;tmp, <span class="type">int</span> last)</span> </span>&#123;  <span class="comment">// last: 上一个单词编号</span></span><br><span class="line">    ans = <span class="built_in">max</span>(ans, (<span class="type">int</span>)tmp.<span class="built_in">size</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (vis[i] &gt;= <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 直接查表，避免重复计算</span></span><br><span class="line">        <span class="type">int</span> k = overlap[last][i];</span><br><span class="line">        <span class="keyword">if</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            vis[i]++;</span><br><span class="line">            <span class="built_in">dfs</span>(tmp + s[i].<span class="built_in">substr</span>(k), i);</span><br><span class="line">            vis[i]--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>完整代码</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">30</span>;</span><br><span class="line"><span class="type">int</span> n, vis[N], ans;</span><br><span class="line">string s[N];</span><br><span class="line"><span class="type">char</span> c;</span><br><span class="line"><span class="type">int</span> overlap[N][N];  <span class="comment">// 预处理的重合矩阵</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">preprocess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            overlap[i][j] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt; <span class="built_in">min</span>(s[i].<span class="built_in">size</span>(), s[j].<span class="built_in">size</span>()); k++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s[i].<span class="built_in">substr</span>(s[i].<span class="built_in">size</span>() - k) == s[j].<span class="built_in">substr</span>(<span class="number">0</span>, k)) &#123;</span><br><span class="line">                    overlap[i][j] = k;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">const</span> string &amp;tmp, <span class="type">int</span> last)</span> </span>&#123;</span><br><span class="line">    ans = <span class="built_in">max</span>(ans, (<span class="type">int</span>)tmp.<span class="built_in">size</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (vis[i] &gt;= <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (overlap[last][i] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            vis[i]++;</span><br><span class="line">            <span class="built_in">dfs</span>(tmp + s[i].<span class="built_in">substr</span>(overlap[last][i]), i);</span><br><span class="line">            vis[i]--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) cin &gt;&gt; s[i];</span><br><span class="line">    cin &gt;&gt; c;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">preprocess</span>();  <span class="comment">// 关键：预处理</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i][<span class="number">0</span>] == c) &#123;</span><br><span class="line">            vis[i]++;</span><br><span class="line">            <span class="built_in">dfs</span>(s[i], i);</span><br><span class="line">            vis[i]--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="Scales-S"   >
          <a href="#Scales-S" class="heading-link"><i class="fas fa-link"></i></a><a href="#Scales-S" class="headerlink" title="Scales S"></a>Scales S</h1>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5194" >P5194 [USACO05DEC] Scales S</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="题意-7"   >
          <a href="#题意-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#题意-7" class="headerlink" title="题意"></a>题意</h2>
      <p>有一个单调不降的序列，给你一个上限，你需要在序列里选出数，让它们累加之后最接近（但是不超过）给定的上限。</p>

        <h2 id="思路-7"   >
          <a href="#思路-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路-7" class="headerlink" title="思路"></a>思路</h2>
      <p> 直接暴力搜索其实很简单，每个砝码选或者不选。不选就下一个，选的话加上这个质量。然后一直递归。考虑完所有砝码后检查是否合法并更新答案。</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX_N = <span class="number">1005</span>;</span><br><span class="line">ll m[MAX_N];    <span class="comment">// 存储每个砝码的质量</span></span><br><span class="line">ll sum;         <span class="comment">// 能称出的最大质量</span></span><br><span class="line">ll n, c;       <span class="comment">// 砝码数量, 天平最大承重</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> index, ll cur)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果已经考虑完所有砝码，更新答案并返回</span></span><br><span class="line">    <span class="keyword">if</span> (index &gt; n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cur &lt;= c) &#123;</span><br><span class="line">            sum = <span class="built_in">max</span>(sum, cur);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 剪枝：如果当前已超重，直接返回</span></span><br><span class="line">    <span class="keyword">if</span> (cur &gt; c) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择1: 选择当前砝码</span></span><br><span class="line">    <span class="built_in">dfs</span>(index + <span class="number">1</span>, cur + m[index]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择2: 不选当前砝码</span></span><br><span class="line">    <span class="built_in">dfs</span>(index + <span class="number">1</span>, cur);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 输入数据</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; m[i];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化最大质量为0</span></span><br><span class="line">    sum = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始DFS搜索：从第一个砝码开始考虑，当前总质量为0</span></span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 输出结果</span></span><br><span class="line">    cout &lt;&lt; sum &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>如果你这么写了，喜提TLE。</p>
<p><strong>如果用dfs想优化时间复杂度，我们通常会进行剪枝</strong>，显然我们已经剪枝过了。那没有办法优化了吗？还能怎样进行剪枝？</p>
<p>注意到题目给出，它给出的序列是单调不降的。那我们可以从最后也就是最大数开始遍历。就可以借助<strong>前缀和</strong>能帮快速判断能否全取。总结一下</p>
<ol>
<li><strong>从后往前考虑</strong>：从最后一个砝码开始（index &#x3D; n）</li>
<li><strong>两个选择</strong>：<ul>
<li>选当前砝码：<code>dfs(index-1, cur + m[index])</code></li>
<li>不选当前砝码：<code>dfs(index-1, cur)</code></li>
</ul>
</li>
<li><strong>两个剪枝</strong>：<ul>
<li>超重剪枝：当前总质量 &gt; 承重</li>
<li>全取剪枝：当前质量 + 剩余所有砝码 ≤ 承重</li>
</ul>
</li>
</ol>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX_N = <span class="number">1005</span>;</span><br><span class="line">ll m[MAX_N];    <span class="comment">// 存储每个砝码的质量</span></span><br><span class="line">ll maxSum;      <span class="comment">// 能称出的最大质量</span></span><br><span class="line">ll pre[MAX_N];  <span class="comment">// 前缀和数组</span></span><br><span class="line">ll n, c;        <span class="comment">// 砝码数量, 天平最大承重</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> index, ll cur)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 更新最大质量</span></span><br><span class="line">    maxSum = <span class="built_in">max</span>(maxSum, cur);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 考虑完所有砝码返回</span></span><br><span class="line">    <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 剪枝1: 如果当前总质量已经超过天平承重，直接返回</span></span><br><span class="line">    <span class="keyword">if</span>(cur &gt; c)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 剪枝2: 如果当前总质量加上剩余所有砝码质量仍然不超过承重，则直接全取</span></span><br><span class="line">    <span class="keyword">if</span>(cur + pre[index] &lt;= c)&#123;</span><br><span class="line">        maxSum = <span class="built_in">max</span>(maxSum, cur + pre[index]);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择当前砝码（如果加上后不超重）</span></span><br><span class="line">    <span class="keyword">if</span>(cur + m[index] &lt;= c)&#123;</span><br><span class="line">        <span class="built_in">dfs</span>(index - <span class="number">1</span>, cur + m[index]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 不选当前砝码</span></span><br><span class="line">    <span class="built_in">dfs</span>(index - <span class="number">1</span>, cur);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 输入数据</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; m[i];</span><br><span class="line">        pre[i] = pre[i - <span class="number">1</span>] + m[i];</span><br><span class="line">    &#125;   </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化最大质量为0</span></span><br><span class="line">    maxSum = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始DFS搜索：从最后一个砝码开始考虑，当前总质量为0</span></span><br><span class="line">    <span class="built_in">dfs</span>(n, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 输出结果</span></span><br><span class="line">    cout &lt;&lt; maxSum &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="XR-2-奇迹"   >
          <a href="#XR-2-奇迹" class="heading-link"><i class="fas fa-link"></i></a><a href="#XR-2-奇迹" class="headerlink" title="[XR-2]奇迹"></a>[XR-2]奇迹</h1>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5440" >洛谷P5440</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="题意-8"   >
          <a href="#题意-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#题意-8" class="headerlink" title="题意"></a>题意</h2>
      <p>给你一个八位数，这八位数中会有不确定的数字用‘-’表示，第 1∼4 位构成年，第 5∼6 位构成月，第 7∼8 位构成日，不足位数用 0 补足，同时，要求日期所代表的这一天真实存在，且年的范围为 1∼9999。要求由“日”组成的两位数，由“月+日”组成的四位数，由“年+月+日”组成的八位数均为<strong>质数</strong>。</p>

        <h2 id="思路-8"   >
          <a href="#思路-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路-8" class="headerlink" title="思路"></a>思路</h2>
      <p>既然是dfs专题，那我们首先想到的就是dfs暴力填充。填充完后判断这个日期是不是一个合法日期。比如肯定不能出现13月或者2月30这种。当然闰年也得注意一下。又因为和质数有关，所以我们需要一个质数判断函数（这里用一下欧拉筛优化）。思路好像很清晰了。那怎么设置这个dfs呢。</p>
<p>要传给dfs的参数是什么，毫无疑问是已经确定好的数字位数d。当d&#x3D;&#x3D;8时我们判断是否符合题意。当d!&#x3D;8时，我们就要判断当前位是不是一个固定的数字。如果是的话直接过，dfs(n+1)，如果不是的话对当前位尝试0-9依次填充。（记得回溯）</p>
<p>欧拉筛板子，没什么好说的</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler_prime</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vis[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= N; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i]) prime[x++] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; x; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(i * prime[j] &gt; N) <span class="keyword">break</span>;</span><br><span class="line">            vis[i * prime[j]] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i % prime[j] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>判断闰年，也很基础</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_run</span><span class="params">(<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(y % <span class="number">4</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(y % <span class="number">100</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(y % <span class="number">400</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>检查日期合法性,分成年月日分别判断合法性</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">legal</span><span class="params">(<span class="type">int</span> y, <span class="type">int</span> m, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//月份不能超过12，年月日不可为0</span></span><br><span class="line">    <span class="keyword">if</span>(m &gt; <span class="number">12</span> || m == <span class="number">0</span> || d == <span class="number">0</span> || y == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//闰年特判</span></span><br><span class="line">    <span class="keyword">if</span>(m == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">is_run</span>(y)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(d &gt; <span class="number">29</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(d &gt; <span class="number">28</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">//判断日期在那个月是否存在</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> daynum[] = &#123;<span class="number">0</span>,<span class="number">31</span>,<span class="number">28</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>&#125;;<span class="comment">//提前预处理，关于月份和日期的一个常用小技巧</span></span><br><span class="line">        <span class="keyword">if</span>(d &gt; daynum[m]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>还有一个比较关键的部分是，你如何存储这个输入，可以让你的遍历更新更方便。因为带特殊符号，所以我们最开始输入一定是字符串。又因为涉及到整数运算，所以我们还要标记一下可以替换的数位。我们用一个数组date来标记，如果date&#x3D;&#x3D;-1，表示可以替换。不然的话date&#x3D;s[i]-‘0’转换为数字。</p>

        <h3 id="dfs构建"   >
          <a href="#dfs构建" class="heading-link"><i class="fas fa-link"></i></a><a href="#dfs构建" class="headerlink" title="dfs构建"></a>dfs构建</h3>
      <p>关键的构建dfs，我们采用按位构建的方法。我们定义dfs(d)表示当前正在处理第d位（从0开始计数）。当d&#x3D;&#x3D;8时，说明我们已经构建了一个完整的8位数，此时进行日期合法性和质数条件的检查。</p>
<p>在dfs过程中，我们维护一个全局变量num，表示当前构建的数字。对于每一位：</p>
<ul>
<li>如果该位是确定的（date[d] !&#x3D; -1），我们直接将这个数字加到num中，然后递归处理下一位</li>
<li>如果该位是不确定的（date[d] &#x3D;&#x3D; -1），我们就需要尝试0-9的所有可能</li>
</ul>
<p>但是直接尝试0-9的所有组合会导致搜索空间很大，所以我们需要进行剪枝优化：</p>
<ol>
<li><strong>月份第一位剪枝</strong>（d&#x3D;&#x3D;4）：月份的第一位只能是0或1，因为月份最大是12，所以当i&#x3D;&#x3D;2时可以直接break，因为20几月不存在</li>
<li><strong>月份有效性剪枝</strong>（d&#x3D;&#x3D;5）：当处理月份的第二位时：<ul>
<li>如果月份第一位是0（date[4]&#x3D;&#x3D;0），那么第二位不能是0，因为00月不存在</li>
<li>如果当前尝试的月份超过12，可以直接break</li>
</ul>
</li>
<li><strong>日期第一位剪枝</strong>（d&#x3D;&#x3D;6）：日期的第一位最大只能是3，因为日期最大是31，所以当i&#x3D;&#x3D;4时可以直接break</li>
</ol>
<p>这些剪枝能显著减少搜索空间，让算法在合理时间内完成。</p>
<p>当构建完8位数后，我们将其分解为年、月、日三部分：</p>
<ul>
<li>年 &#x3D; num &#x2F; 10000</li>
<li>月 &#x3D; (num % 10000) &#x2F; 100</li>
<li>日 &#x3D; num % 100</li>
</ul>
<p>然后检查：</p>
<ol>
<li>日期是否合法（年份1-9999，月份1-12，日期符合当月天数）</li>
<li>日、月日、年月日三个数是否都是质数</li>
</ol>
<p>如果都满足，就找到一个有效解，ans加1。</p>
<p>附上完整代码</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> vis[N + <span class="number">10</span>];    </span><br><span class="line"><span class="type">int</span> prime[N + <span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> date[<span class="number">10</span>];  </span><br><span class="line"><span class="type">int</span> num = <span class="number">0</span>;   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler_prime</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vis[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= N; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i]) prime[x++] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; x; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(i * prime[j] &gt; N) <span class="keyword">break</span>;</span><br><span class="line">            vis[i * prime[j]] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i % prime[j] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_run</span><span class="params">(<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(y % <span class="number">4</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(y % <span class="number">100</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(y % <span class="number">400</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">legal</span><span class="params">(<span class="type">int</span> y, <span class="type">int</span> m, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(m &gt; <span class="number">12</span> || m == <span class="number">0</span> || d == <span class="number">0</span> || y == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(m == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">is_run</span>(y)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(d &gt; <span class="number">29</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(d &gt; <span class="number">28</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> daynum[] = &#123;<span class="number">0</span>,<span class="number">31</span>,<span class="number">28</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(d &gt; daynum[m]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(d == <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="type">int</span> y = num / <span class="number">10000</span>;</span><br><span class="line">        <span class="type">int</span> m = (num % <span class="number">10000</span>) / <span class="number">100</span>;</span><br><span class="line">        <span class="type">int</span> day = num % <span class="number">100</span>;  </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">legal</span>(y, m, day)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!vis[day] &amp;&amp; !vis[m * <span class="number">100</span> + day] &amp;&amp; !vis[y * <span class="number">10000</span> + m * <span class="number">100</span> + day]) &#123;</span><br><span class="line">                ans++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(date[d] != <span class="number">-1</span>) &#123;</span><br><span class="line">        num = num * <span class="number">10</span> + date[d];</span><br><span class="line">        <span class="built_in">dfs</span>(d + <span class="number">1</span>);</span><br><span class="line">        num /= <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">9</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(d == <span class="number">4</span> &amp;&amp; i == <span class="number">2</span>) <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">if</span>(d == <span class="number">5</span> &amp;&amp; i == <span class="number">0</span> &amp;&amp; date[<span class="number">4</span>] == <span class="number">0</span>) <span class="keyword">continue</span>;  </span><br><span class="line">        <span class="keyword">if</span>(d == <span class="number">5</span> &amp;&amp; date[<span class="number">4</span>] * <span class="number">10</span> + i &gt; <span class="number">12</span>) <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">if</span>(d == <span class="number">6</span> &amp;&amp; i == <span class="number">4</span>) <span class="keyword">break</span>;  </span><br><span class="line">        </span><br><span class="line">        date[d] = i;</span><br><span class="line">        num = num * <span class="number">10</span> + i;</span><br><span class="line">        <span class="built_in">dfs</span>(d + <span class="number">1</span>);</span><br><span class="line">        date[d] = <span class="number">-1</span>;</span><br><span class="line">        num /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    <span class="built_in">Euler_prime</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        ans = <span class="number">0</span>;</span><br><span class="line">        num = <span class="number">0</span>;</span><br><span class="line">        string s;</span><br><span class="line">        cin &gt;&gt; s;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i] == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">                date[i] = <span class="number">-1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                date[i] = s[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">0</span>);</span><br><span class="line">        cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="出题人题解"   >
          <a href="#出题人题解" class="heading-link"><i class="fas fa-link"></i></a><a href="#出题人题解" class="headerlink" title="出题人题解"></a>出题人题解</h2>
      <p>看到题解的那一刻我是有点破防的。我对我写出的逻辑清晰的代码十分满意，但洋洋洒洒也有一百行以上了。题解是把预处理做到了极致。</p>
<p>采用<strong>预处理+模式匹配</strong>的解法，核心思想是：</p>
<ol>
<li><strong>预先计算所有可能的奇迹日期</strong></li>
<li><strong>对每个查询，检查预处理日期是否匹配输入模式</strong></li>
</ol>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可能的质数日和每月天数</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> prime_days[] = &#123;<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">31</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> month_days[] = &#123;<span class="number">0</span>, <span class="number">31</span>, <span class="number">28</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>&#125;;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; valid_dates; <span class="comment">// 存储所有奇迹日期</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断质数</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_prime</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= x; i++)</span><br><span class="line">        <span class="keyword">if</span> (x % i == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断闰年</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_leap_year</span><span class="params">(<span class="type">int</span> year)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (year % <span class="number">4</span> == <span class="number">0</span> &amp;&amp; year % <span class="number">100</span> != <span class="number">0</span>) || (year % <span class="number">400</span> == <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预处理所有奇迹日期</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">preprocess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 处理普通日期</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> month = <span class="number">1</span>; month &lt;= <span class="number">12</span>; month++) &#123;</span><br><span class="line">        <span class="type">int</span> max_day = month_days[month];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">10</span>; j++) &#123;</span><br><span class="line">            <span class="type">int</span> day = prime_days[j];</span><br><span class="line">            <span class="keyword">if</span> (day &gt; max_day) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// 检查月日是否为质数</span></span><br><span class="line">            <span class="type">int</span> month_day = month * <span class="number">100</span> + day;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">is_prime</span>(month_day)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// 检查日是否为质数</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">is_prime</span>(day)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">// 组合年份检查完整日期</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> year = <span class="number">1</span>; year &lt;= <span class="number">9999</span>; year++) &#123;</span><br><span class="line">                <span class="comment">// 特殊处理2月29日</span></span><br><span class="line">                <span class="keyword">if</span> (month == <span class="number">2</span> &amp;&amp; day == <span class="number">29</span> &amp;&amp; !<span class="built_in">is_leap_year</span>(year)) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">int</span> full_date = year * <span class="number">10000</span> + month_day;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">is_prime</span>(full_date)) &#123;</span><br><span class="line">                    valid_dates.<span class="built_in">push_back</span>(full_date);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">preprocess</span>(); <span class="comment">// 预处理</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T--) &#123;</span><br><span class="line">        string pattern;</span><br><span class="line">        cin &gt;&gt; pattern;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 检查每个预处理日期是否匹配模式</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> date : valid_dates) &#123;</span><br><span class="line">            string date_str = <span class="built_in">to_string</span>(date);</span><br><span class="line">            <span class="comment">// 补前导0到8位</span></span><br><span class="line">            <span class="keyword">while</span> (date_str.<span class="built_in">length</span>() &lt; <span class="number">8</span>) &#123;</span><br><span class="line">                date_str = <span class="string">&quot;0&quot;</span> + date_str;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">bool</span> match = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (pattern[i] != <span class="string">&#x27;-&#x27;</span> &amp;&amp; pattern[i] != date_str[i]) &#123;</span><br><span class="line">                    match = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (match) count++;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; count &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="油滴扩展"   >
          <a href="#油滴扩展" class="heading-link"><i class="fas fa-link"></i></a><a href="#油滴扩展" class="headerlink" title="油滴扩展"></a>油滴扩展</h1>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1378" >P1378 油滴扩展 - 洛谷</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="题意-9"   >
          <a href="#题意-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#题意-9" class="headerlink" title="题意"></a>题意</h2>
      <p>在一个矩形框内给定 N 个点，我们可以按一定顺序在这些点上放置油滴。<br>油滴会扩展成圆形，直到碰到矩形边界或其它已放置的油滴。<br>目标是<strong>安排放置顺序</strong>，使所有油滴覆盖的总面积最大，从而矩形剩余面积最小。</p>

        <h2 id="思路-9"   >
          <a href="#思路-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路-9" class="headerlink" title="思路"></a>思路</h2>
      <p>人为什么能蠢成这样，半径应该是<strong>连续值</strong>，由几何条件决定，不是离散枚举。就这样写出了一段史山(划掉)</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">mark</span><span class="params">(point p,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = p.x - r; i &lt;= p.x + r; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = p.y - r; j &lt;= p.y + r; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= <span class="number">0</span> &amp;&amp; i &lt; n &amp;&amp; j &gt;= <span class="number">0</span> &amp;&amp; j &lt; n) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((i - p.x) * (i - p.x) + (j - p.y) * (j - p.y) &lt;= r * r) &#123;</span><br><span class="line">                    a[i][j] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>言归正传。</p>
<ul>
<li><p>对于当前要放置的油滴，它的最大半径由两个因素决定：</p>
<ol>
<li>到矩形四边的距离</li>
<li>到已放置油滴的圆心距离减去该油滴的半径</li>
</ol>
</li>
<li><p>半径公式：</p>
<p>text</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = min( dist_to_boundary, dist_to_other_circle_radius )</span><br></pre></td></tr></table></div></figure>



<p>其中 <code>dist_to_other_circle_radius</code> 对于每个已放置油滴 j 是 <code>dist(i, j) - r_j</code>，如果小于 0 则半径取 0。</p>
</li>
<li><p>用 DFS 枚举所有排列顺序，计算每种顺序下的油滴总面积，取最大值。</p>
</li>
</ul>
<hr>

        <h3 id="DFS-框架"   >
          <a href="#DFS-框架" class="heading-link"><i class="fas fa-link"></i></a><a href="#DFS-框架" class="headerlink" title="DFS 框架"></a>DFS 框架</h3>
      <ul>
<li><strong>状态</strong>：当前已放置的油滴数量 <code>cnt</code>，当前油滴总面积 <code>total_area</code></li>
<li><strong>选择</strong>：所有未使用的油滴</li>
<li><strong>递归深度</strong>：油滴数量 N</li>
<li><strong>回溯</strong>：恢复油滴的使用状态和半径</li>
</ul>
<hr>

        <h3 id="关键细节"   >
          <a href="#关键细节" class="heading-link"><i class="fas fa-link"></i></a><a href="#关键细节" class="headerlink" title="关键细节"></a>关键细节</h3>
      <ol>
<li><strong>矩形边界处理</strong><br>输入的两个顶点不一定是左下和右上，需要先交换确保 <code>x1 ≤ x2, y1 ≤ y2</code>。</li>
<li><strong>半径计算</strong><br>半径是连续值，由几何条件决定，不是离散枚举。</li>
<li><strong>四舍五入输出</strong><br>最终结果用 <code>round()</code> 处理。</li>
</ol>
<p>附上代码</p>
<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">double</span> x, y, x2, y2;</span><br><span class="line"><span class="type">double</span> max_oil = <span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> vis[<span class="number">10</span>];</span><br><span class="line"><span class="type">double</span> r[<span class="number">10</span>]; </span><br><span class="line">vector&lt;pair&lt;<span class="type">double</span>, <span class="type">double</span>&gt;&gt; points;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 两点距离</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">dist</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y, <span class="type">double</span> x2, <span class="type">double</span> y2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>((x - x2) * (x - x2) + (y - y2) * (y - y2));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> cnt, <span class="type">double</span> total_area)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cnt == n) &#123;</span><br><span class="line">        max_oil = <span class="built_in">max</span>(max_oil, total_area);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i]) &#123;</span><br><span class="line">            <span class="comment">// 计算油滴 i 的最大半径</span></span><br><span class="line">            <span class="type">double</span> max_r = <span class="number">1e9</span>;</span><br><span class="line">            <span class="comment">// 到矩形四边的距离</span></span><br><span class="line">            max_r = <span class="built_in">min</span>(max_r, <span class="built_in">abs</span>(points[i].first - x));</span><br><span class="line">            max_r = <span class="built_in">min</span>(max_r, <span class="built_in">abs</span>(points[i].first - x2));</span><br><span class="line">            max_r = <span class="built_in">min</span>(max_r, <span class="built_in">abs</span>(points[i].second - y));</span><br><span class="line">            max_r = <span class="built_in">min</span>(max_r, <span class="built_in">abs</span>(points[i].second - y2));</span><br><span class="line">            <span class="comment">// 到已放置油滴的距离</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (vis[j]) &#123;</span><br><span class="line">                    <span class="type">double</span> d = <span class="built_in">dist</span>(points[i].first, points[i].second, points[j].first, points[j].second);</span><br><span class="line">                    max_r = <span class="built_in">min</span>(max_r, d - r[j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果 max_r &lt; 0，说明这个点在其他油滴内部，半径取 0</span></span><br><span class="line">            <span class="keyword">if</span> (max_r &lt; <span class="number">0</span>) max_r = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            vis[i] = <span class="literal">true</span>;</span><br><span class="line">            r[i] = max_r;</span><br><span class="line">            <span class="built_in">dfs</span>(cnt + <span class="number">1</span>, total_area + PI * r[i] * r[i]);</span><br><span class="line">            vis[i] = <span class="literal">false</span>;</span><br><span class="line">            r[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    cin &gt;&gt; x &gt;&gt; y &gt;&gt; x2 &gt;&gt; y2;</span><br><span class="line">    points.<span class="built_in">resize</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; points[i].first &gt;&gt; points[i].second;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x &gt; x2) <span class="built_in">swap</span>(x, x2);</span><br><span class="line">    <span class="keyword">if</span> (y &gt; y2) <span class="built_in">swap</span>(y, y2);</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> rect_area = (x2 - x) * (y2 - y);</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">0</span>, <span class="number">0.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ans = <span class="built_in">round</span>(rect_area - max_oil);</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="https://1artemise.github.io">artemis</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="https://1artemise.github.io/2025/11/21/bfs&amp;&amp;dfs/">https://1artemise.github.io/2025/11/21/bfs&amp;&amp;dfs/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://1artemise.github.io/tags/%E7%AE%97%E6%B3%95/">算法</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://1artemise.github.io/tags/acm/">acm</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://1artemise.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://1artemise.github.io/tags/dfs/">dfs</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://1artemise.github.io/tags/bfs/">bfs</a></span></div><nav class="post-paginator paginator"><div class="paginator-next"><a class="paginator-next__link" href="/2025/11/21/%E6%80%9D%E7%BB%B4%E9%A2%98/"><span class="paginator-prev__text">喵喵思维题</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div><div class="comments" id="comments"><div id="giscus-container"></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%87%E6%95%B0%E5%9E%8Bdfs-%E9%80%89%E6%88%96%E4%B8%8D%E9%80%89"><span class="toc-number">1.</span> <span class="toc-text">
          指数型dfs(选或不选)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%83%A4%E9%B8%A1"><span class="toc-number">1.1.</span> <span class="toc-text">
          烤鸡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E6%84%8F"><span class="toc-number">1.1.1.</span> <span class="toc-text">
          题意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">1.1.2.</span> <span class="toc-text">
          思路</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PERKET"><span class="toc-number">1.2.</span> <span class="toc-text">
          PERKET</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E6%84%8F-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">
          题意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">
          思路</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A8%E6%8E%92%E5%88%97%E5%9E%8Bdfs"><span class="toc-number">2.</span> <span class="toc-text">
          全排列型dfs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E6%8E%92%E5%88%97%E9%97%AE%E9%A2%98"><span class="toc-number">2.1.</span> <span class="toc-text">
          全排列问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E6%84%8F-2"><span class="toc-number">2.1.1.</span> <span class="toc-text">
          题意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-2"><span class="toc-number">2.1.2.</span> <span class="toc-text">
          思路</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%81%AB%E6%98%9F%E4%BA%BA"><span class="toc-number">2.2.</span> <span class="toc-text">
          火星人</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E6%84%8F-3"><span class="toc-number">2.2.1.</span> <span class="toc-text">
          题意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-3"><span class="toc-number">2.2.2.</span> <span class="toc-text">
          思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#next-permutation-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">
          next_permutation 工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">
          时间复杂度</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E5%9E%8Bdfs"><span class="toc-number">3.</span> <span class="toc-text">
          组合型dfs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text">
          选数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E6%84%8F-4"><span class="toc-number">3.1.1.</span> <span class="toc-text">
          题意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-4"><span class="toc-number">3.1.2.</span> <span class="toc-text">
          思路</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">
          八皇后问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E6%84%8F-5"><span class="toc-number">4.1.</span> <span class="toc-text">
          题意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-5"><span class="toc-number">4.2.</span> <span class="toc-text">
          思路</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E8%AF%8D%E6%8E%A5%E9%BE%99"><span class="toc-number">5.</span> <span class="toc-text">
          单词接龙</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E6%84%8F-6"><span class="toc-number">5.1.</span> <span class="toc-text">
          题意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-6"><span class="toc-number">5.2.</span> <span class="toc-text">
          思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E9%87%8D%E5%90%88%E4%B8%8D%E5%8F%AF%E4%BB%A5%E5%8C%85%E5%90%AB"><span class="toc-number">5.2.1.</span> <span class="toc-text">
          有重合不可以包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%98%AF%E5%90%A6%E5%8C%B9%E9%85%8D%EF%BC%88%E5%8F%AF%E4%BB%A5%E9%87%8D%E5%90%88%EF%BC%89"><span class="toc-number">5.2.2.</span> <span class="toc-text">
          字符串是否匹配（可以重合）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%BC%E6%8E%A5%E6%96%B9%E5%BC%8F"><span class="toc-number">5.2.3.</span> <span class="toc-text">
          拼接方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AC%A1%E6%95%B0%E6%8E%A7%E5%88%B6"><span class="toc-number">5.2.4.</span> <span class="toc-text">
          次数控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%84%E4%B8%8AAC%E4%BB%A3%E7%A0%81"><span class="toc-number">5.2.5.</span> <span class="toc-text">
          附上AC代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">5.2.6.</span> <span class="toc-text">
          补充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E9%87%8D%E5%90%88"><span class="toc-number">5.2.6.1.</span> <span class="toc-text">
          预处理重合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E4%B9%8B%E5%90%8E%E9%87%8D%E6%96%B0%E6%9F%A5%E8%A1%A8"><span class="toc-number">5.2.6.2.</span> <span class="toc-text">
          预处理之后重新查表</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Scales-S"><span class="toc-number">6.</span> <span class="toc-text">
          Scales S</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E6%84%8F-7"><span class="toc-number">6.1.</span> <span class="toc-text">
          题意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-7"><span class="toc-number">6.2.</span> <span class="toc-text">
          思路</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XR-2-%E5%A5%87%E8%BF%B9"><span class="toc-number">7.</span> <span class="toc-text">
          [XR-2]奇迹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E6%84%8F-8"><span class="toc-number">7.1.</span> <span class="toc-text">
          题意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-8"><span class="toc-number">7.2.</span> <span class="toc-text">
          思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dfs%E6%9E%84%E5%BB%BA"><span class="toc-number">7.2.1.</span> <span class="toc-text">
          dfs构建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BA%E9%A2%98%E4%BA%BA%E9%A2%98%E8%A7%A3"><span class="toc-number">7.3.</span> <span class="toc-text">
          出题人题解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B2%B9%E6%BB%B4%E6%89%A9%E5%B1%95"><span class="toc-number">8.</span> <span class="toc-text">
          油滴扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E6%84%8F-9"><span class="toc-number">8.1.</span> <span class="toc-text">
          题意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-9"><span class="toc-number">8.2.</span> <span class="toc-text">
          思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DFS-%E6%A1%86%E6%9E%B6"><span class="toc-number">8.2.1.</span> <span class="toc-text">
          DFS 框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%BB%86%E8%8A%82"><span class="toc-number">8.2.2.</span> <span class="toc-text">
          关键细节</span></a></li></ol></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/背景.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">jade</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/1artemise" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="https://plus.google.com/" target="_blank" rel="noopener" data-popover="Google" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-google"></i></span></a><a class="sidebar-ov-social-item" href="https://twitter.com/" target="_blank" rel="noopener" data-popover="Twitter" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-twitter"></i></span></a><a class="sidebar-ov-social-item" href="https://youtube.com/" target="_blank" rel="noopener" data-popover="Youtube" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-youtube"></i></span></a><a class="sidebar-ov-social-item" href="wjywq12345" target="_blank" rel="noopener" data-popover="微信" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-weixin"></i></span></a><a class="sidebar-ov-social-item" href="2985725866" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-qq"></i></span></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2025</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>artemis</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v7.3.0</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.8.0</span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon" data-popover-pos="up" data-popover="访问人数"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon" data-popover-pos="up" data-popover="浏览总量"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div><!-- 在 footer.pug 文件末尾添加以下代码--><script>// 点击特效代码
(function() {
    // 创建爱心特效
    function createHeartEffect(x, y) {
        const heart = document.createElement('div');
        heart.style.cssText = `
            position: fixed;
            left: ${x}px;
            top: ${y}px;
            width: 20px;
            height: 20px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff4757"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>') no-repeat center center;
            background-size: contain;
            pointer-events: none;
            z-index: 9999;
            transition: all 1s ease-out;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        `;
        document.body.appendChild(heart);
        
        setTimeout(() => {
            heart.style.opacity = '0';
            heart.style.transform = `translate(-50%, -100px) scale(0.5)`;
        }, 50);
        
        setTimeout(() => {
            document.body.removeChild(heart);
        }, 1000);
    }

    // 创建文字特效
    function createTextEffect(x, y, text) {
        const textEl = document.createElement('div');
        textEl.style.cssText = `
            position: fixed;
            left: ${x}px;
            top: ${y}px;
            color: #87ceeb;
            font-size: 16px;
            font-weight: bold;
            pointer-events: none;
            z-index: 9999;
            transition: all 1s ease-out;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
        `;
        textEl.textContent = text;
        document.body.appendChild(textEl);
        
        setTimeout(() => {
            textEl.style.opacity = '0';
            textEl.style.transform = `translate(-50%, -80px) scale(0.8)`;
        }, 50);
        
        setTimeout(() => {
            document.body.removeChild(textEl);
        }, 1000);
    }

    // 点击事件处理
    document.addEventListener('click', function(e) {
        const effects = ['heart', 'text'];
        const randomEffect = effects[Math.floor(Math.random() * effects.length)];
        
        if (randomEffect === 'heart') {
            createHeartEffect(e.clientX, e.clientY);
        } else {
            const texts = ['今日方知我是我', '宁作我，岂其卿', '高山仰止', '霁月光风', '我心清且微', '犹怜草木青'];
            const randomText = texts[Math.floor(Math.random() * texts.length)];
            createTextEffect(e.clientX, e.clientY, randomText);
        }
    });

    // 移动端触摸事件
    document.addEventListener('touchstart', function(e) {
        const touch = e.touches[0];
        const effects = ['heart', 'text'];
        const randomEffect = effects[Math.floor(Math.random() * effects.length)];
        
        if (randomEffect === 'heart') {
            createHeartEffect(touch.clientX, touch.clientY);
        } else {
            const texts = ['今日方知我是我', '宁作我，岂其卿', '高山仰止', '霁月光风', '我心清且微', '犹怜草木青'];
            const randomText = texts[Math.floor(Math.random() * texts.length)];
            createTextEffect(touch.clientX, touch.clientY, randomText);
        }
    });
})();
// 鼠标跟随粒子特效</script><script>(function() {
    class Particle {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.size = Math.random() * 5 + 2;
            this.speedX = Math.random() * 3 - 1.5;
            this.speedY = Math.random() * 3 - 1.5;
            this.color = `hsl(${Math.random() * 60 + 180}, 70%, 60%)`; // 蓝色系
        }
        
        update() {
            this.x += this.speedX;
            this.y += this.speedY;
            if (this.size > 0.2) this.size -= 0.1;
        }
        
        draw(ctx) {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    let particles = [];
    let canvas = document.createElement('canvas');
    let ctx = canvas.getContext('2d');
    canvas.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
    `;
    document.body.appendChild(canvas);

    function init() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        for (let i = 0; i < particles.length; i++) {
            particles[i].update();
            particles[i].draw(ctx);
            
            if (particles[i].size <= 0.2) {
                particles.splice(i, 1);
                i--;
            }
        }
        requestAnimationFrame(animate);
    }

    init();
    animate();

    let mouseX = 0;
    let mouseY = 0;
    document.addEventListener('mousemove', (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
        
        for (let i = 0; i < 5; i++) {
            particles.push(new Particle(mouseX, mouseY));
        }
    });

    window.addEventListener('resize', init);
})();</script></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script>function loadGiscus() {
  var container = document.getElementById('giscus-container');
  
  if (!container) {
    return;
  }

  // 清空容器内容，防止重复加载
  container.innerHTML = '';

  var script = document.createElement('script');
  script.src = 'https://giscus.app/client.js';
  script.setAttribute('data-repo', '1artemise/-for_comment');
  script.setAttribute('data-repo-id', 'R_kgDOP1AvRA');
  script.setAttribute('data-category', 'Announcements');
  script.setAttribute('data-category-id', 'DIC_kwDOP1AvRM4Cvx7c');
  script.setAttribute('data-mapping', 'pathname');
  script.setAttribute('data-strict', '0');
  script.setAttribute('data-reactions-enabled', '1');
  script.setAttribute('data-emit-metadata', '0');
  script.setAttribute('data-input-position', 'top');
  script.setAttribute('data-theme', 'light');
  script.setAttribute('data-lang', 'zh-CN');
  script.setAttribute('data-loading', 'lazy');
  script.setAttribute('crossorigin', 'anonymous');
  script.setAttribute('async', '');
  
  if (false) {
    script.setAttribute('data-pjax-rm', '');
  }
  
  container.appendChild(script);
}

if (false) {
  loadGiscus();
} else {
  window.addEventListener('DOMContentLoaded', loadGiscus, false);
}</script><script src="/js/utils.js?v=2.8.0"></script><script src="/js/stun-boot.js?v=2.8.0"></script><script src="/js/scroll.js?v=2.8.0"></script><script src="/js/header.js?v=2.8.0"></script><script src="/js/sidebar.js?v=2.8.0"></script></body></html>